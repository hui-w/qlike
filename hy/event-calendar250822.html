<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=800, initial-scale=1" />
    <title>Event Calendar</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        min-width: 800px;
        margin: 20px auto;
        padding: 0 10px;
        color: #222;
      }
      h1 {
        border-top: 1px solid #ddd;
        font-size: 18px;
        text-align: right;
        padding: 4px 0;
      }
      h2 {
        font-size: 16px;
        font-weight: bold;
        color: #1c7ed6;
        background: #f8f9fa;
        border-left: 4px solid #74c0fc;
        padding: 6px 10px;
        margin: 20px 0 12px;
        border-radius: 4px;
      }
      .controls {
        margin-top: 15px;
        margin-bottom: 15px;
      }
      label {
        margin-right: 12px;
        font-size: 14px;
      }
      input[type="number"],
      input[type="text"],
      input[type="date"] {
        padding: 4px 6px;
        font-size: 14px;
        border: 1px solid #bbb;
        border-radius: 3px;
      }
      input[type="number"] {
        width: 30px;
      }
      input[type="text"] {
        width: 160px;
      }
      input[type="date"] {
        width: 130px;
      }
      button {
        font-size: 13px;
        padding: 2px 8px;
        margin: 0 4px;
        border: 1px solid #bbb;
        border-radius: 3px;
        background: transparent;
        color: #555;
        font-weight: normal;
        cursor: pointer;
        transition: background 0.15s ease;
      }
      button:hover {
        background: #f0f0f0;
      }
      button.cancel {
        background: #868e96;
        border-color: #606770;
        color: white;
      }
      #calendars {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }
      .month {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px 6px;
        font-size: 14px;
      }
      .month-title {
        text-align: center;
        font-weight: bold;
        margin-bottom: 6px;
      }
      .weekdays,
      .days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
      }
      .weekdays div {
        font-weight: bold;
        color: #666;
        padding-bottom: 3px;
      }
      .day {
        padding: 5px 0;
        margin: 1px;
        border-radius: 3px;
        user-select: none;
      }
      .day.past-event {
        background: #e0e0e0;
        color: #888;
        font-weight: normal;
      }
      .day.event {
        background: #74c0fc;
        color: #1c7ed6;
        font-weight: bold;
      }
      .day.today {
        border: 1px solid #ff6b6b;
        background: #ffe3e3;
        font-weight: bold;
      }
      ul {
        list-style: none;
        padding-left: 0;
        margin: 10px 0;
      }
      li {
        margin-bottom: 6px;
        display: flex;
        align-items: center;
      }
      li span {
        flex-grow: 1;
        cursor: pointer;
        transition: color 0.2s ease;
      }
      li span:hover {
        color: #1c7ed6;
        text-decoration: underline;
      }
      li input[type="text"],
      li input[type="date"] {
        font-size: 14px;
        padding: 3px 5px;
        margin-right: 6px;
        border: 1px solid #bbb;
        border-radius: 3px;
        width: 130px;
      }
      #addEventSection {
        border-top: 1px solid #ddd;
        padding-top: 10px;
      }
      #calendarSection {
        border-top: 1px solid #ddd;
        padding-top: 10px;
      }
      #addEventError {
        color: #d64545;
        margin-top: 5px;
        font-size: 13px;
      }
      .hint {
        font-size: 12px;
        color: #666;
        margin: 0 0 8px;
      }
      .event-date {
        font-size: 12px;
        color: #666;
        margin-left: 4px;
      }
      .event-row {
        background: #fcfcfc;
        padding: 4px 6px;
        border-radius: 4px;
        margin-bottom: 4px;
      }
      .interval-row {
        font-size: 12px;
        color: #666;
        padding: 2px 4px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <h2>Event List</h2>
    <p class="hint">Tap an event to edit its details.</p>
    <ul id="eventList" aria-label="Event List"></ul>

    <div id="addEventSection">
      <h2>Add New Event</h2>
      <p class="hint">
        Try adding a new event — it will appear in the calendar and the days
        between events will be calculated automatically.
      </p>
      <label
        >Name:
        <input type="text" id="newEventName" placeholder="Event name" />
      </label>
      <label
        >Start:
        <input type="date" id="newEventStart" />
      </label>
      <label
        >End:
        <input type="date" id="newEventEnd" />
      </label>
      <button id="addEventBtn">Add</button>
      <p id="addEventError"></p>
    </div>

    <div id="calendarSection">
      <h2>Calenar View</h2>
      <p class="hint">
        The calendar shows months around your events. Future event days are
        highlighted in blue.
      </p>
      <div id="calendars"></div>
      <div class="controls">
        <label>
          Display
          <input type="number" id="monthsBefore" min="0" value="1" /> months
          before and
          <input type="number" id="monthsAfter" min="0" value="3" /> months
          after
        </label>
        <button id="applyBtn">Refresh Calendar</button>
      </div>
    </div>

    <h1>Event Calendar</h1>

    <script>
      function generateId() {
        return "_" + Math.random().toString(36).substr(2, 9);
      }
      function clamp(date) {
        return new Date(date.getFullYear(), date.getMonth(), date.getDate());
      }
      function daysBetween(a, b) {
        return Math.round(Math.abs((b - a) / (1000 * 60 * 60 * 24)));
      }
      function parseDateFromInput(value) {
        const parts = value.split("-");
        if (parts.length !== 3) return null;
        return new Date(
          parseInt(parts[0]),
          parseInt(parts[1]) - 1,
          parseInt(parts[2])
        );
      }
      function formatDateToInput(date) {
        const y = date.getFullYear();
        const m = (date.getMonth() + 1).toString().padStart(2, "0");
        const d = date.getDate().toString().padStart(2, "0");
        return `${y}-${m}-${d}`;
      }
      function formatDateReadable(date) {
        return date.toLocaleDateString(undefined, {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      let events = [
        {
          id: generateId(),
          name: "25_Spring",
          start: new Date(2025, 3, 6),
          end: new Date(2025, 3, 14),
        },
        {
          id: generateId(),
          name: "25_Summer",
          start: new Date(2025, 6, 29),
          end: new Date(2025, 7, 7),
        },
        {
          id: generateId(),
          name: "25_FRA",
          start: new Date(2025, 8, 27),
          end: new Date(2025, 9, 5),
        },
        {
          id: generateId(),
          name: "25_TYO",
          start: new Date(2025, 11, 21),
          end: new Date(2025, 11, 28),
        },
        {
          id: generateId(),
          name: "26_ORD",
          start: new Date(2026, 0, 26),
          end: new Date(2026, 0, 30),
        },
        {
          id: generateId(),
          name: "26_Spring",
          start: new Date(2026, 3, 6),
          end: new Date(2026, 3, 14),
        },
        {
          id: generateId(),
          name: "26_June",
          start: new Date(2026, 5, 21),
          end: new Date(2026, 5, 29),
        },
        {
          id: generateId(),
          name: "26_Fall",
          start: new Date(2026, 8, 13),
          end: new Date(2026, 8, 22),
        },
        {
          id: generateId(),
          name: "26_Xmas",
          start: new Date(2026, 11, 20),
          end: new Date(2026, 11, 28),
        },
      ];

      const monthsBeforeInput = document.getElementById("monthsBefore");
      const monthsAfterInput = document.getElementById("monthsAfter");
      const applyBtn = document.getElementById("applyBtn");

      const eventListEl = document.getElementById("eventList");
      const calendarsEl = document.getElementById("calendars");

      const addEventBtn = document.getElementById("addEventBtn");
      const newEventNameInput = document.getElementById("newEventName");
      const newEventStartInput = document.getElementById("newEventStart");
      const newEventEndInput = document.getElementById("newEventEnd");
      const addEventErrorEl = document.getElementById("addEventError");

      let editingId = null;

      function updateMonthRangeDefaults() {
        if (events.length === 0) {
          monthsBeforeInput.value = 0;
          monthsAfterInput.value = 3;
          return;
        }
        const today = new Date();
        const todayMonthIndex = today.getFullYear() * 12 + today.getMonth();
        const startMonths = events.map(
          (evt) => evt.start.getFullYear() * 12 + evt.start.getMonth()
        );
        const endMonths = events.map(
          (evt) => evt.end.getFullYear() * 12 + evt.end.getMonth()
        );
        const minMonth = Math.min(...startMonths);
        const maxMonth = Math.max(...endMonths);
        monthsBeforeInput.value = Math.max(0, todayMonthIndex - minMonth);
        monthsAfterInput.value = Math.max(0, maxMonth - todayMonthIndex);
      }

      function renderEventList() {
        eventListEl.innerHTML = "";
        const sorted = [...events].sort((a, b) => a.start - b.start);
        sorted.forEach((evt, idx) => {
          const li = document.createElement("li");
          li.className = "event-row";

          if (editingId === evt.id) {
            const nameInput = document.createElement("input");
            nameInput.type = "text";
            nameInput.value = evt.name;

            const startInput = document.createElement("input");
            startInput.type = "date";
            startInput.value = formatDateToInput(evt.start);

            const endInput = document.createElement("input");
            endInput.type = "date";
            endInput.value = formatDateToInput(evt.end);

            const saveBtn = document.createElement("button");
            saveBtn.textContent = "Save";
            saveBtn.className = "save";
            saveBtn.onclick = () => {
              if (!nameInput.value.trim()) {
                alert("Please enter a name");
                return;
              }
              if (!startInput.value) {
                alert("Please select a start date");
                return;
              }
              if (!endInput.value) {
                alert("Please select an end date");
                return;
              }
              const sDate = parseDateFromInput(startInput.value);
              const eDate = parseDateFromInput(endInput.value);
              if (eDate < sDate) {
                alert("End date cannot be before start date");
                return;
              }
              evt.name = nameInput.value.trim();
              evt.start = sDate;
              evt.end = eDate;
              editingId = null;
              updateMonthRangeDefaults();
              renderAll();
            };

            const cancelBtn = document.createElement("button");
            cancelBtn.textContent = "Cancel";
            cancelBtn.className = "cancel";
            cancelBtn.onclick = () => {
              editingId = null;
              renderEventList();
            };

            li.appendChild(nameInput);
            li.appendChild(startInput);
            li.appendChild(endInput);
            li.appendChild(saveBtn);
            li.appendChild(cancelBtn);
          } else {
            const span = document.createElement("span");
            span.innerHTML = `${
              evt.name
            }: <span class="event-date">${formatDateReadable(
              evt.start
            )} — ${formatDateReadable(evt.end)} (${
              daysBetween(evt.start, evt.end) + 1
            } days)</span>`;
            span.title = "Click to edit";
            span.onclick = () => {
              editingId = evt.id;
              renderEventList();
            };
            li.appendChild(span);

            if (idx < sorted.length - 1) {
              const gap = daysBetween(evt.end, sorted[idx + 1].start) - 1;
              const gapInfo = document.createElement("div");
              gapInfo.className = "interval-row";
              gapInfo.textContent = `→ ${sorted[idx + 1].name}: ${
                gap >= 0 ? gap : 0
              } days between`;
              li.appendChild(gapInfo);
            }

            const delBtn = document.createElement("button");
            delBtn.textContent = "Delete";
            delBtn.className = "delete";
            delBtn.title = "Delete event";
            delBtn.onclick = () => {
              if (confirm(`Delete event "${evt.name}"?`)) {
                events = events.filter((e) => e.id !== evt.id);
                if (editingId === evt.id) editingId = null;
                updateMonthRangeDefaults();
                renderAll();
              }
            };
            li.appendChild(delBtn);
          }
          eventListEl.appendChild(li);
        });
      }

      function renderCalendars() {
        calendarsEl.innerHTML = "";
        const today = new Date();
        const before = parseInt(monthsBeforeInput.value) || 0;
        const after = parseInt(monthsAfterInput.value) || 0;
        for (let i = -before; i <= after; i++) {
          const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
          calendarsEl.appendChild(renderMonth(d));
        }
      }

      function renderMonth(firstOfMonth) {
        const div = document.createElement("div");
        div.className = "month";

        const title = document.createElement("div");
        title.className = "month-title";
        title.textContent = firstOfMonth.toLocaleString("default", {
          month: "long",
          year: "numeric",
        });
        div.appendChild(title);

        const weekdays = document.createElement("div");
        weekdays.className = "weekdays";
        ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"].forEach((d) => {
          const wd = document.createElement("div");
          wd.textContent = d;
          weekdays.appendChild(wd);
        });
        div.appendChild(weekdays);

        const daysGrid = document.createElement("div");
        daysGrid.className = "days";

        const year = firstOfMonth.getFullYear();
        const month = firstOfMonth.getMonth();
        const firstDayIndex = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDayIndex; i++) {
          daysGrid.appendChild(document.createElement("div"));
        }

        const todayTime = clamp(new Date()).getTime();

        for (let d = 1; d <= daysInMonth; d++) {
          const dayDate = new Date(year, month, d);
          const dayDiv = document.createElement("div");
          dayDiv.className = "day";
          dayDiv.textContent = d;

          const t = clamp(dayDate).getTime();
          if (t === todayTime) dayDiv.classList.add("today");

          events.forEach((evt) => {
            if (
              t >= clamp(evt.start).getTime() &&
              t <= clamp(evt.end).getTime()
            ) {
              if (evt.end.getTime() < todayTime) {
                dayDiv.classList.add("past-event");
              } else {
                dayDiv.classList.add("event");
              }
            }
          });
          daysGrid.appendChild(dayDiv);
        }

        div.appendChild(daysGrid);
        return div;
      }

      function addNewEvent() {
        addEventErrorEl.textContent = "";
        const name = newEventNameInput.value.trim();
        const start = newEventStartInput.value;
        const end = newEventEndInput.value;

        if (!name) {
          addEventErrorEl.textContent = "Please enter event name.";
          return;
        }
        if (!start) {
          addEventErrorEl.textContent = "Please select start date.";
          return;
        }
        if (!end) {
          addEventErrorEl.textContent = "Please select end date.";
          return;
        }
        if (parseDateFromInput(end) < parseDateFromInput(start)) {
          addEventErrorEl.textContent = "End date cannot be before start date.";
          return;
        }

        events.push({
          id: generateId(),
          name,
          start: parseDateFromInput(start),
          end: parseDateFromInput(end),
        });
        newEventNameInput.value = "";
        newEventStartInput.value = "";
        newEventEndInput.value = "";
        addEventErrorEl.textContent = "";
        updateMonthRangeDefaults();
        renderAll();
      }

      function renderAll() {
        renderEventList();
        renderCalendars();
      }

      addEventBtn.onclick = addNewEvent;
      applyBtn.onclick = () => {
        renderCalendars();
      };

      updateMonthRangeDefaults();
      renderAll();
    </script>
  </body>
</html>
